{"project":"platform/upstream/qemu-accel","branch":"tizen","id":"Ifb15d69ec83ec8bcf6ade52bdc4ca960aff481ce","number":"31718","subject":"Add auto-generation of spec-files and enable Gold linker","owner":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"url":"https://review.tizen.org/gerrit/31718","commitMessage":"Add auto-generation of spec-files and enable Gold linker\n\nRationale:\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\n1. There is a big mess (target-dependent or legacy) in our spec-files for\nqemu-accel packages, and it\u0027s hard to maintain it.\n\n2. Cross Gold linker must be enabled, because some packages want to use\nLTO build (crosswalk).\n\nChanges:\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\n* pre_checkin.sh : New pre-checkin script.\n------------------------------------------\n  Please, run this script in \"package\" directory before creating a commit for\n  qemu-accel package. It copies qemu-accel.spec.in to qemu-accel-*.spec\n  files and replaces the following macros to target-dependent ones:\n  - EMULATED_ARCH_LONG\n  - EMULATED_ARCH_SHORT\n  - EMULATED_ARCH_SYNONIM\n  - EMULATED_ARCH_TRIPLE_SHORT\n  - EMULATED_ARCH_TRIPLE_LONG\n  Corresponding RPM macros are defined in each spec-file independently,\n  and these 5 lines are the only 5 lines on which these spec-files\n  differ. They are:\n\n+----------------------------+---------------------------+---------------------+\n|           Macro            |          Value            |        Value        |\n|                            |        for armv7l         |     for aarch64     |\n+----------------------------+---------------------------+---------------------+\n| EMULATED_ARCH_LONG         |          armv7l           |       aarch64       |\n+----------------------------+---------------------------+---------------------+\n| EMULATED_ARCH_SHORT        |           arm             |       aarch64       |\n+----------------------------+---------------------------+---------------------+\n| EMULATED_ARCH_SYNONIM      |           arm             |        arm64        |\n+----------------------------+---------------------------+---------------------+\n| EMULATED_ARCH_TRIPLE_SHORT | arm-tizen-linux-gnueabi   | aarch64-tizen-linux |\n+----------------------------+---------------------------+---------------------+\n| EMULATED_ARCH_TRIPLE_LONG  | armv7l-tizen-linux-gnueabi| aarch64-tizen-linux |\n+----------------------------+---------------------------+---------------------+\n\n* qemu-accel.spec.in : New spec-file template.\n----------------------------------------------\n  All spec-files should be generated from that. Our version of qemu-accel had\n  been inherited from OpenSUSE long time ago, and since that time nobody\n  worried about the fact that they must not have target-dependent code\n  (which is hard to maintain).\n  This template was written based on latest versions of\n  qemu-accel-aarch64.spec and qemu-accel-armv7l.spec, so that to get all\n  needed actions from both of them.\n  + The support for Gold linker was added, since it is now needed by\n  crosswalk, and cross-*-binutils package now can provide *-ld.gold\n  binaries.\n  + The support for cross elfutils was added, since native eu-strip fails on\n  gold-linked binaries for unknown reason (under qemu).\n  + The support for cross XSLT was added, since it helps to reduce build\n  time of systemd from 701s to 407s\n\n* gcc-wrapper.sh : New script.\n------------------------------\n  Used at run-time as a wrapper for gcc, g++ and other compiler names.\n  Before that it was generated via spec-file. Once it becomes more and\n  more complex, it looks better to separate it to independent file.\n  Target-dependent things are generated into script wrapper-config.sh,\n  which is generated via spec-file.\n\n* ld-wrapper.sh : New script.\n----------------------------\n  Ditto for ld and ld.gold.\n\n* qemu-accel-aarch64.spec : Auto-generated from qemu-accel.spec.in\n------------------------------------------------------------------\n\n* qemu-accel-armv7l.spec : Ditto\n--------------------------------\n\n* baselibs.conf : Changed corresponding to new spec-file policy\n---------------------------------------------------------------\n  Removed legacy enabling/disabling of binfmt mode, because we added it\n  for debugging purposes during the enabling of aarch64 build. Now it\u0027s\n  not needed.\n  Binaries /usr/bin/qemu-* now are not packed in qemu-accel-* packages,\n  because they conflict with qemu-linux-user-cross-* package. If needed\n  files /usr/bin/qemu-* do not exist, post-install script creates\n  symbolic links as follows: /usr/bin/qemu-* -\u003e /qemu/qemu-*\n\n* qemu-accel.spec : Removed\n---------------------------\n  The current structure of OBS packages looks as follows:\n\n    qemu-accel (build disabled)\n     |\n     +---- (linkpac) ----\u003e qemu-accel-armv7l  (build enabled)\n     |\n     +---- (linkpac) ----\u003e qemu-accel-aarch64 (build enabled)\n\n  qemu-accel.spec is not used at all, so it looks better to delete it at\n  all. In this case we will have state \"excluded\" for it.\n\n* qemu-accel-armv7hl.spec : Removed\n-----------------------------------\n  Actually, there is no ARM hard-float build in Tizen OBS. There is no\n  toolchain for it, and it seems that there are no plans to enable it.\n  In any case, anybody who will need to have qemu-accelerated build for\n  armv7hl should do the following:\n  1. Provide build of cross-toolchain for armv7hl architecture.\n  2. Provide build of other build utilities for armv7hl architecture.\n  3. Add support for it in pre_checkin.sh in this package, so that to\n  set proper macros (they must be synchronized with installatio\n  directories for gcc and binutils).\n\n  The same things are actual for other new architectures that will ever\n  be added to Tizen OBS.\n\n* qemu-accel-armv7el.spec : Removed\n-----------------------------------\n  AFAIK, armv7el is just a synonim for armv7l. So there it\u0027s not needed\n  to have separate entities for them.\n\n* qemu-accel-armv7l.changes : Removed\n-------------------------------------\n  All changes are now tracked via Git, so it\u0027s not needed to duplicate\n  them here.\n\n* qemu-accel-armv7hl.changes : Removed\n--------------------------------------\n  Ditto.\n\n* qemu-accel-armv7hl-rpmlintrc : Removed\n----------------------------------------\n  This file was added to workaround rpmlint errors. But now we have no\n  rpmlint errors (just warnings), and this file is not needed now.\n\nChange-Id: Ifb15d69ec83ec8bcf6ade52bdc4ca960aff481ce\nSigned-off-by: Ilya Palachev \u003ci.palachev@samsung.com\u003e\n","createdOn":1418058275,"lastUpdated":1419329516,"sortKey":"0031f9a300007be6","open":true,"status":"NEW","comments":[{"timestamp":1418058275,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 1."},{"timestamp":1418058328,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Patch Set 1:\n\nPatch is under verification now. Please, does not submit it until I verify it."},{"timestamp":1418132702,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 2."},{"timestamp":1418139864,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 3."},{"timestamp":1418150353,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 4."},{"timestamp":1418150801,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 5."},{"timestamp":1418151271,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 6."},{"timestamp":1418152381,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 7."},{"timestamp":1418190855,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Patch Set 7: Verified-1\n\nThis version has wrong \"gcc\" replacement.\nBuild fails."},{"timestamp":1418192554,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Uploaded patch set 8."},{"timestamp":1418193106,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Uploaded patch set 9."},{"timestamp":1418194349,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Uploaded patch set 10."},{"timestamp":1418195258,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Uploaded patch set 11."},{"timestamp":1418197239,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Uploaded patch set 12."},{"timestamp":1418197408,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Uploaded patch set 13."},{"timestamp":1418197582,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Uploaded patch set 14."},{"timestamp":1418198983,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Uploaded patch set 15."},{"timestamp":1418199824,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Uploaded patch set 16."},{"timestamp":1418210081,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 17."},{"timestamp":1418210168,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 18."},{"timestamp":1418213349,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 19."},{"timestamp":1418287528,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 20."},{"timestamp":1418366318,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Uploaded patch set 21."},{"timestamp":1418382199,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 22."},{"timestamp":1418734656,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 23."},{"timestamp":1418735378,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 24."},{"timestamp":1418737696,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 25."},{"timestamp":1418820096,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Patch Set 25: Code-Review+1 Verified+1\n\nBuild of Tizen:Common is verfied at\nhttps://build.tizen.org/project/show?project\u003ddevel%3Aarm_toolchain%3AMobile%3ATizen_Common"},{"timestamp":1418886335,"reviewer":{"name":"Vyacheslav Barinov","email":"v.barinov@samsung.com","username":"vbarinov"},"message":"Patch Set 25: Code-Review+1 Verified+1"},{"timestamp":1419247682,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 26."},{"timestamp":1419261054,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 27."},{"timestamp":1419329516,"reviewer":{"name":"Ilya Palachev","email":"i.palachev@samsung.com","username":"ipalachev"},"message":"Uploaded patch set 28."}]}
